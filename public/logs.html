<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logs - Soltradeview</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1f2937;
        }
        ::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }
        
        /* Smooth transitions */
        .transition-all {
            transition: all 0.3s ease;
        }
        
        /* Table hover effects */
        tr:hover td {
            background-color: rgba(55, 65, 81, 0.5);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 text-gray-200 min-h-screen">
    <div class="p-6">
        <div class="max-w-7xl mx-auto space-y-6">
            <!-- Header with gradient border -->
            <div class="bg-gray-800 rounded-lg p-6 border border-transparent bg-gradient-to-r from-cyan-500/20 via-purple-500/20 to-cyan-500/20">
                <div class="flex items-center justify-between">
                    <div class="space-y-1">
                        <h1 class="text-3xl font-bold bg-gradient-to-r from-cyan-400 to-purple-400 bg-clip-text text-transparent">
                            System Logs
                        </h1>
                        <p class="text-gray-400 text-sm">Real-time monitoring and analysis</p>
                    </div>
                    <div class="flex space-x-4">
                        <button class="px-4 py-2 bg-purple-700 hover:bg-purple-600 text-white rounded-md flex items-center transition-all shadow-lg hover:shadow-purple-500/20">
                            <span>Export Logs</span>
                            <i class="ml-2 fa-solid fa-file-download"></i>
                        </button>
                        <button class="px-4 py-2 bg-cyan-600 hover:bg-cyan-500 text-white rounded-md flex items-center transition-all shadow-lg hover:shadow-cyan-500/20">
                            <span>Refresh</span>
                            <i class="ml-2 fa-solid fa-sync"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="bg-gray-800 rounded-lg p-4 border border-gray-700">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-400 text-sm">Total Trades</p>
                            <h3 class="text-2xl font-bold text-white" id="totalTrades">0</h3>
                        </div>
                        <div class="bg-blue-500/20 p-3 rounded-lg">
                            <i class="fas fa-exchange-alt text-blue-400"></i>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-800 rounded-lg p-4 border border-gray-700">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-400 text-sm">Success Rate</p>
                            <h3 class="text-2xl font-bold text-white" id="successRate">0%</h3>
                        </div>
                        <div class="bg-green-500/20 p-3 rounded-lg">
                            <i class="fas fa-chart-line text-green-400"></i>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-800 rounded-lg p-4 border border-gray-700">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-400 text-sm">Error Rate</p>
                            <h3 class="text-2xl font-bold text-white" id="errorRate">0%</h3>
                        </div>
                        <div class="bg-red-500/20 p-3 rounded-lg">
                            <i class="fas fa-exclamation-triangle text-red-400"></i>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-800 rounded-lg p-4 border border-gray-700">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-gray-400 text-sm">Avg Response Time</p>
                            <h3 class="text-2xl font-bold text-white" id="avgTime">0ms</h3>
                        </div>
                        <div class="bg-yellow-500/20 p-3 rounded-lg">
                            <i class="fas fa-clock text-yellow-400"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Filters and search bar -->
            <div class="bg-gray-800 rounded-lg p-4 border border-gray-700">
                <div class="flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0">
                    <div class="flex space-x-2">
                        <button class="px-4 py-2 bg-cyan-600 hover:bg-cyan-500 rounded-md transition-all">All Logs</button>
                        <button class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-md transition-all">Trade Logs</button>
                        <button class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-md transition-all">Error Logs</button>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="relative">
                            <input type="text" placeholder="Search logs" 
                                   class="pl-10 pr-4 py-2 bg-gray-700 rounded-md border border-gray-600 text-sm focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-all">
                            <i class="fas fa-search absolute left-3 top-2.5 text-gray-400"></i>
                        </div>
                        <input type="date" 
                               class="px-4 py-2 bg-gray-700 rounded-md border border-gray-600 text-sm focus:ring-2 focus:ring-cyan-500 focus:border-transparent transition-all">
                        <button class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-md transition-all">
                            <i class="fas fa-filter mr-2"></i>Filters
                        </button>
                    </div>
                </div>
            </div>

            <!-- Trade Logs Table -->
            <div class="bg-gray-800 rounded-lg border border-gray-700 overflow-hidden shadow-xl">
                <div class="p-4 border-b border-gray-700 bg-gray-800">
                    <h2 class="text-xl font-semibold text-cyan-400">Trade Logs</h2>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-left text-sm" id="tradeLogs">
                        <thead class="bg-gray-700 text-gray-300">
                            <tr>
                                <th class="px-6 py-3 font-semibold">Timestamp</th>
                                <th class="px-6 py-3 font-semibold">Type</th>
                                <th class="px-6 py-3 font-semibold">Message</th>
                                <th class="px-6 py-3 font-semibold">Details</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-700"></tbody>
                    </table>
                </div>
            </div>

            <!-- Error Logs Table -->
            <div class="bg-gray-800 rounded-lg border border-gray-700 overflow-hidden shadow-xl">
                <div class="p-4 border-b border-gray-700 bg-gray-800">
                    <h2 class="text-xl font-semibold text-red-400">Error Logs</h2>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-left text-sm" id="errorLogs">
                        <thead class="bg-gray-700 text-gray-300">
                            <tr>
                                <th class="px-6 py-3 font-semibold">Timestamp</th>
                                <th class="px-6 py-3 font-semibold">Error</th>
                                <th class="px-6 py-3 font-semibold">Request</th>
                                <th class="px-6 py-3 font-semibold">Execution Time</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-700"></tbody>
                    </table>
                </div>
            </div>

            <!-- Pagination -->
            <div class="flex justify-between items-center bg-gray-800 rounded-lg p-4 border border-gray-700">
                <button class="px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-md transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                    <i class="fas fa-chevron-left mr-2"></i>Previous
                </button>
                <span class="text-gray-400">Page <span class="text-white">1</span> of <span class="text-white">1</span></span>
                <button class="px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-md transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                    Next<i class="fas fa-chevron-right ml-2"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        // Timestamp formatting function
        const formatTimestamp = (isoString) => {
            const date = new Date(isoString);
            
            // Format date components
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const year = date.getFullYear();
            
            // Format time components
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            const seconds = String(date.getSeconds()).padStart(2, '0');
            const milliseconds = String(date.getMilliseconds()).padStart(3, '0');

            // Combine into final format
            return `${month}/${day}/${year} ${hours}:${minutes}:${seconds}.${milliseconds}`;
        };

        const fetchLogs = async () => {
            try {
                const response = await fetch('/api/logs');
                const data = await response.json();
                
                // Filter and process trade logs
                const tradeLogs = data.tradeLogs.filter(log => 
                    !log.message.includes('Application started') &&
                    (log.message.includes('Trade') || log.message.includes('transaction'))
                );

                // Populate trade logs with formatted timestamp
                const tradeLogsBody = document.querySelector('#tradeLogs tbody');
                tradeLogsBody.innerHTML = tradeLogs
                    .map(log => {
                        const isSuccess = log.message.includes('successfully');
                        const isRequest = log.message.includes('request');
                        
                        return `
                            <tr class="border-b border-gray-700 hover:bg-gray-700/50 transition-colors duration-150">
                                <td class="px-6 py-3 font-mono text-gray-400 whitespace-nowrap">
                                    ${formatTimestamp(log.timestamp)}
                                </td>
                                <td class="px-6 py-3">
                                    <span class="px-2 py-1 ${
                                        isSuccess ? 'bg-green-500/20 text-green-400' :
                                        isRequest ? 'bg-cyan-500/20 text-cyan-400' :
                                        'bg-yellow-500/20 text-yellow-400'
                                    } text-xs rounded-full">
                                        ${isSuccess ? 'SUCCESS' : isRequest ? 'REQUEST' : 'PENDING'}
                                    </span>
                                </td>
                                <td class="px-6 py-3">${log.message}</td>
                                <td class="px-6 py-3 font-mono">
                                    ${formatMetadata(log.metadata)}
                                </td>
                            </tr>
                        `;
                    })
                    .join('');

                // Populate error logs with formatted timestamp
                const errorLogsBody = document.querySelector('#errorLogs tbody');
                errorLogsBody.innerHTML = data.errorLogs
                    .map(log => `
                        <tr class="border-b border-gray-700 hover:bg-gray-700/50 transition-colors duration-150">
                            <td class="px-6 py-3 font-mono text-gray-400 whitespace-nowrap">
                                ${formatTimestamp(log.timestamp)}
                            </td>
                            <td class="px-6 py-3">
                                <span class="px-2 py-1 bg-red-500/20 text-red-400 text-xs rounded-full">
                                    ${log.metadata?.error || 'Unknown error'}
                                </span>
                            </td>
                            <td class="px-6 py-3 font-mono">
                                ${formatRequestDetails(log.metadata?.request)}
                            </td>
                            <td class="px-6 py-3">
                                ${formatExecutionTime(log.metadata?.executionTime)}
                            </td>
                        </tr>
                    `)
                    .join('');

                // Update stats
                updateStats(data.tradeLogs, data.errorLogs);
            } catch (error) {
                console.error('Error fetching logs:', error);
            }
        };

        // Helper function to format request details
        const formatRequestDetails = (request) => {
            if (!request) return 'N/A';
            return `
                <div class="space-y-1">
                    <div class="flex items-center space-x-2">
                        <span class="text-cyan-400">${request.ticker}</span>
                        <span class="text-gray-400">|</span>
                        <span class="${request.action === 'buy' ? 'text-green-400' : 'text-red-400'}">
                            ${request.action.toUpperCase()}
                        </span>
                        <span class="text-gray-400">|</span>
                        <span class="text-yellow-400">${request.order_size}</span>
                    </div>
                    <div class="text-xs text-gray-500">
                        ${request.timestamp ? formatTimestamp(request.timestamp) : ''}
                    </div>
                </div>
            `;
        };

        // Helper function to format execution time
        const formatExecutionTime = (executionTime) => {
            if (!executionTime) return 'N/A';
            return `<span class="text-yellow-400">${executionTime}</span>`;
        };

        // Helper function to format metadata
        const formatMetadata = (metadata) => {
            if (!metadata) return 'N/A';
            
            const details = [];
            if (metadata.action) details.push(`<span class="${metadata.action === 'buy' ? 'text-green-400' : 'text-red-400'}">${metadata.action.toUpperCase()}</span>`);
            if (metadata.ticker) details.push(`<span class="text-cyan-400">${metadata.ticker}</span>`);
            if (metadata.order_size) details.push(`<span class="text-yellow-400">${metadata.order_size}</span>`);
            if (metadata.execution_price) details.push(`<span class="text-green-400">$${metadata.execution_price}</span>`);
            if (metadata.execution_time) details.push(`<span class="text-gray-400">${metadata.execution_time}</span>`);
            
            return details.join(' <span class="text-gray-600">|</span> ');
        };

        // Initial fetch and auto-refresh
        fetchLogs();
        setInterval(fetchLogs, 30000);

        // Add refresh button functionality
        document.querySelector('button:has(.fa-sync)').addEventListener('click', fetchLogs);

        // Add stats calculation
        const updateStats = (tradeLogs, errorLogs) => {
            const totalTrades = tradeLogs.length;
            const successfulTrades = tradeLogs.filter(log => log.message.includes('successfully')).length;
            const successRate = totalTrades ? ((successfulTrades / totalTrades) * 100).toFixed(1) : 0;
            const errorRate = totalTrades ? ((errorLogs.length / totalTrades) * 100).toFixed(1) : 0;
            
            // Calculate average execution time
            const executionTimes = errorLogs
                .map(log => parseInt(log.metadata?.executionTime))
                .filter(time => !isNaN(time));
            const avgTime = executionTimes.length 
                ? (executionTimes.reduce((a, b) => a + b, 0) / executionTimes.length).toFixed(0)
                : 0;

            document.getElementById('totalTrades').textContent = totalTrades;
            document.getElementById('successRate').textContent = `${successRate}%`;
            document.getElementById('errorRate').textContent = `${errorRate}%`;
            document.getElementById('avgTime').textContent = `${avgTime}ms`;
        };
    </script>
</body>
</html> 