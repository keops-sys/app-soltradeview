<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logs - Soltradeview</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="min-h-screen bg-gray-900 text-gray-200 p-6">
        <div class="max-w-7xl mx-auto">
            <!-- Header -->
            <div class="flex items-center justify-between">
                <h1 class="text-3xl font-bold text-cyan-400">System Logs</h1>
                <div class="flex space-x-4">
                    <button class="px-4 py-2 bg-purple-700 hover:bg-purple-800 text-white rounded-md flex items-center">
                        <span>Export Logs</span>
                        <i class="ml-2 fa-solid fa-file-download"></i>
                    </button>
                    <button class="px-4 py-2 bg-cyan-600 hover:bg-cyan-700 text-white rounded-md flex items-center">
                        <span>Refresh</span>
                        <i class="ml-2 fa-solid fa-sync"></i>
                    </button>
                </div>
            </div>

            <!-- Filters and search bar -->
            <div class="mt-6 flex justify-between items-center">
                <div class="flex space-x-4">
                    <button class="px-4 py-2 bg-gray-800 hover:bg-gray-700 rounded-md">All Logs</button>
                    <button class="px-4 py-2 bg-gray-800 hover:bg-gray-700 rounded-md">Trade Logs</button>
                    <button class="px-4 py-2 bg-gray-800 hover:bg-gray-700 rounded-md">Error Logs</button>
                </div>
                <div class="flex items-center space-x-4">
                    <input type="text" placeholder="Search logs" 
                           class="px-4 py-2 bg-gray-800 rounded-md border border-gray-700 text-sm focus:ring-cyan-500 focus:ring-2">
                    <input type="date" class="px-4 py-2 bg-gray-800 rounded-md border border-gray-700 text-sm">
                    <button class="px-4 py-2 bg-cyan-600 hover:bg-cyan-700 rounded-md">Filters</button>
                </div>
            </div>

            <!-- Trade Logs Table -->
            <div class="overflow-x-auto mt-8 bg-gray-800 shadow-lg rounded-md">
                <table class="w-full text-left text-sm" id="tradeLogs">
                    <thead class="bg-gray-700">
                        <tr>
                            <th class="px-6 py-3">Timestamp</th>
                            <th class="px-6 py-3">Type</th>
                            <th class="px-6 py-3">Message</th>
                            <th class="px-6 py-3">Details</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <!-- Error Logs Table -->
            <div class="overflow-x-auto mt-8 bg-gray-800 shadow-lg rounded-md">
                <table class="w-full text-left text-sm" id="errorLogs">
                    <thead class="bg-gray-700">
                        <tr>
                            <th class="px-6 py-3">Timestamp</th>
                            <th class="px-6 py-3">Error</th>
                            <th class="px-6 py-3">Request</th>
                            <th class="px-6 py-3">Execution Time</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <!-- Pagination -->
            <div class="mt-4 flex justify-between items-center">
                <button class="px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-md">Previous</button>
                <span>Page 1 of 1</span>
                <button class="px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-md">Next</button>
            </div>
        </div>
    </div>

    <script>
        const fetchLogs = async () => {
            try {
                const response = await fetch('/api/logs');
                const data = await response.json();
                
                // Filter out application start messages and process only trade-related logs
                const tradeLogs = data.tradeLogs.filter(log => 
                    !log.message.includes('Application started') &&
                    (log.message.includes('Trade') || log.message.includes('transaction'))
                );

                // Populate trade logs
                const tradeLogsBody = document.querySelector('#tradeLogs tbody');
                tradeLogsBody.innerHTML = tradeLogs
                    .map(log => {
                        const isSuccess = log.message.includes('successfully');
                        const isRequest = log.message.includes('request');
                        
                        return `
                            <tr class="border-b border-gray-700 hover:bg-gray-700">
                                <td class="px-6 py-3 font-mono">${log.timestamp}</td>
                                <td class="px-6 py-3">
                                    <span class="px-2 py-1 ${
                                        isSuccess ? 'bg-green-500/20 text-green-400' :
                                        isRequest ? 'bg-cyan-500/20 text-cyan-400' :
                                        'bg-yellow-500/20 text-yellow-400'
                                    } text-xs rounded-full">
                                        ${isSuccess ? 'SUCCESS' : isRequest ? 'REQUEST' : 'PENDING'}
                                    </span>
                                </td>
                                <td class="px-6 py-3">${log.message}</td>
                                <td class="px-6 py-3 font-mono">
                                    ${formatMetadata(log.metadata)}
                                </td>
                            </tr>
                        `;
                    })
                    .join('');

                // Populate error logs (keep existing error logs handling)
                const errorLogsBody = document.querySelector('#errorLogs tbody');
                errorLogsBody.innerHTML = data.errorLogs
                    .map(log => `
                        <tr class="border-b border-gray-700 hover:bg-gray-700">
                            <td class="px-6 py-3 font-mono">${log.timestamp}</td>
                            <td class="px-6 py-3">
                                <span class="px-2 py-1 bg-red-500/20 text-red-400 text-xs rounded-full">
                                    ${log.metadata?.error || 'Unknown error'}
                                </span>
                            </td>
                            <td class="px-6 py-3 font-mono">
                                ${log.metadata?.request 
                                    ? `${log.metadata.request.ticker} ${log.metadata.request.action} ${log.metadata.request.order_size}` 
                                    : 'N/A'}
                            </td>
                            <td class="px-6 py-3">${log.metadata?.executionTime || 'N/A'}</td>
                        </tr>
                    `)
                    .join('');

            } catch (error) {
                console.error('Error fetching logs:', error);
            }
        };

        // Helper function to format metadata
        const formatMetadata = (metadata) => {
            if (!metadata) return 'N/A';
            
            const details = [];
            if (metadata.action) details.push(`${metadata.action.toUpperCase()}`);
            if (metadata.ticker) details.push(metadata.ticker);
            if (metadata.order_size) details.push(metadata.order_size);
            if (metadata.execution_price) details.push(`$${metadata.execution_price}`);
            if (metadata.execution_time) details.push(metadata.execution_time);
            
            return details.join(' | ');
        };

        // Initial fetch and auto-refresh
        fetchLogs();
        setInterval(fetchLogs, 30_000);

        // Add refresh button functionality
        document.querySelector('button:has(.fa-sync)').addEventListener('click', fetchLogs);
    </script>
</body>
</html> 